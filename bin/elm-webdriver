#!/usr/bin/env bash

if [[ $# -gt 0 ]];
then
	if [[ $1 == "--"* ]]
	then
		FILE="Main.elm"
	else
		FILE="$1"
		shift
	fi
else
	FILE="Main.elm"
fi

MY_PATH=`dirname "$0"`
TARGET=__main.js
TARGET=`readlink -f $TARGET`

compile() {
	elm-make "$FILE" --output "$1" > /dev/null
}

compile "$TARGET" && /usr/bin/env node $MY_PATH/runner.js "$TARGET" $*

EXIT=$?

if [ -f "__main.js" ]
then
	rm $TARGET
fi

exit $EXIT
